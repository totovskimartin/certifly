{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <h1>Debug Information</h1>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Organization Information</h5>
        </div>
        <div class="card-body">
            <pre>{{ organization | tojson(indent=2) }}</pre>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Users in Organization</h5>
        </div>
        <div class="card-body">
            <pre>{{ users | tojson(indent=2) }}</pre>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Current User</h5>
        </div>
        <div class="card-body">
            <pre>{{ user | tojson(indent=2) }}</pre>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header">
            <h5>Available Users API Test</h5>
        </div>
        <div class="card-body">
            <div id="apiTestResult">Loading...</div>
        </div>
    </div>
    
    <a href="{{ url_for('add_organization_user', org_id=organization.id) }}" class="btn btn-primary">Back to Add Members</a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const apiTestResult = document.getElementById('apiTestResult');
    
    // Test the API endpoint
    fetch(`/api/get_available_users?org_id={{ organization.id }}`)
        .then(response => {
            apiTestResult.innerHTML += `<p>Response status: ${response.status}</p>`;
            return response.json();
        })
        .then(data => {
            apiTestResult.innerHTML += `<p>Success: ${data.success}</p>`;
            if (data.success) {
                apiTestResult.innerHTML += `<p>Available users: ${data.users.length}</p>`;
                apiTestResult.innerHTML += `<pre>${JSON.stringify(data.users, null, 2)}</pre>`;
            } else {
                apiTestResult.innerHTML += `<p>Error: ${data.message}</p>`;
            }
        })
        .catch(error => {
            apiTestResult.innerHTML += `<p>Error: ${error.message}</p>`;
        });
});
</script>
{% endblock %}
